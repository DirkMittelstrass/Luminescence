<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Nonlinear Least Squares Fit for CW-OSL curves <code>[beta version]</code> — fit_CWCurve • Luminescence</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Nonlinear Least Squares Fit for CW-OSL curves <code>[beta version]</code> — fit_CWCurve" />

<meta property="og:description" content="The function determines the weighted least-squares estimates of the
component parameters of a CW-OSL signal for a given maximum number of
components and returns various component parameters. The fitting procedure
uses the nls function with the port algorithm." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Luminescence</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/index.html">
    <span class="fa fa-play"></span>
     
    Articles
  </a>
</li>
<li>
  <a href="../reference/index.html">References</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../news/NEWS_Version0.7.0.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/R-Lum/Luminescence">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Nonlinear Least Squares Fit for CW-OSL curves <code>[beta version]</code></h1>
    
    <div class="hidden name"><code>fit_CWCurve.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The function determines the weighted least-squares estimates of the
component parameters of a CW-OSL signal for a given maximum number of
components and returns various component parameters. The fitting procedure
uses the nls function with the <code>port</code> algorithm.</p>
    
    </div>

    <pre class="usage"><span class='fu'>fit_CWCurve</span>(<span class='no'>values</span>, <span class='no'>n.components.max</span>, <span class='kw'>fit.failure_threshold</span> <span class='kw'>=</span> <span class='fl'>5</span>,
  <span class='kw'>fit.method</span> <span class='kw'>=</span> <span class='st'>"port"</span>, <span class='kw'>fit.trace</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>fit.calcError</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>LED.power</span> <span class='kw'>=</span> <span class='fl'>36</span>, <span class='kw'>LED.wavelength</span> <span class='kw'>=</span> <span class='fl'>470</span>, <span class='kw'>cex.global</span> <span class='kw'>=</span> <span class='fl'>0.6</span>,
  <span class='kw'>sample_code</span> <span class='kw'>=</span> <span class='st'>"Default"</span>, <span class='no'>output.path</span>, <span class='kw'>output.terminal</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>output.terminalAdvanced</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>plot</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>values</th>
      <td><p><a href='RLum.Data.Curve-class.html'>RLum.Data.Curve</a> or data.frame (<strong>required</strong>):
x, y data of measured values (time and counts). See examples.</p></td>
    </tr>
    <tr>
      <th>n.components.max</th>
      <td><p>vector (<em>optional</em>):
maximum number of components that are to be used for fitting.
The upper limit is 7.</p></td>
    </tr>
    <tr>
      <th>fit.failure_threshold</th>
      <td><p>vector (<em>with default</em>):
limits the failed fitting attempts.</p></td>
    </tr>
    <tr>
      <th>fit.method</th>
      <td><p>character (<em>with default</em>):
select fit method, allowed values: <code>'port'</code> and <code>'LM'</code>. <code>'port'</code> uses the 'port'
routine usint the funtion nls <code>'LM'</code> utilises the function <code>nlsLM</code> from
the package <code>minpack.lm</code> and with that the Levenberg-Marquardt algorithm.</p></td>
    </tr>
    <tr>
      <th>fit.trace</th>
      <td><p>logical (<em>with default</em>):
traces the fitting process on the terminal.</p></td>
    </tr>
    <tr>
      <th>fit.calcError</th>
      <td><p>logical (<em>with default</em>):
calculate 1-sigma error range of components using confint</p></td>
    </tr>
    <tr>
      <th>LED.power</th>
      <td><p>numeric (<em>with default</em>):
LED power (max.) used for intensity ramping in mW/cm^2.
<strong>Note:</strong> The value is used for the calculation of the absolute
photoionisation cross section.</p></td>
    </tr>
    <tr>
      <th>LED.wavelength</th>
      <td><p>numeric (<em>with default</em>):
LED wavelength used for stimulation in nm.
<strong>Note:</strong> The value is used for the calculation of the absolute
photoionisation cross section.</p></td>
    </tr>
    <tr>
      <th>cex.global</th>
      <td><p>numeric (<em>with default</em>):
global scaling factor.</p></td>
    </tr>
    <tr>
      <th>sample_code</th>
      <td><p>character (<em>optional</em>):
sample code used for the plot and the optional output table (mtext).</p></td>
    </tr>
    <tr>
      <th>output.path</th>
      <td><p>character (<em>optional</em>):
output path for table output containing the results of the fit. The file
name is set automatically. If the file already exists in the directory,
the values are appended.</p></td>
    </tr>
    <tr>
      <th>output.terminal</th>
      <td><p>logical (<em>with default</em>):
terminal ouput with fitting results.</p></td>
    </tr>
    <tr>
      <th>output.terminalAdvanced</th>
      <td><p>logical (<em>with default</em>):
enhanced terminal output. Requires <code>output.terminal = TRUE</code>.
If <code>output.terminal = FALSE</code> no advanced output is possible.</p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p>logical (<em>with default</em>):
returns a plot of the fitted curves.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>further arguments and graphical parameters passed to plot.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><strong>plot (<em>optional</em>)</strong></p>
<p>the fitted CW-OSL curves are returned as plot.</p>
<p><strong>table (<em>optional</em>)</strong></p>
<p>an output table (*.csv) with parameters of the fitted components is
provided if the <code>output.path</code> is set.</p>
<p><strong>RLum.Results</strong></p>
<p>Beside the plot and table output options, an <a href='RLum.Results-class.html'>RLum.Results</a> object is
returned.</p>
<p><code>fit</code>:
an <code>nls</code> object (<code>$fit</code>) for which generic R functions are
provided, e.g. summary, confint, profile. For more
details, see nls.</p>
<p><code>output.table</code>:
a data.frame containing the summarised parameters including the error</p>
<p><code>component.contribution.matrix</code>:
matrix containing the values for the component to sum contribution plot
(<code>$component.contribution.matrix</code>).</p>
<p>Matrix structure:<br />
Column 1 and 2: time and <code>rev(time)</code> values <br />
Additional columns are used for the components, two for each component,
containing I0 and n0. The last columns <code>cont.</code> provide information on
the relative component contribution for each time interval including the row
sum for this values.</p>
<p><strong>object</strong></p>
<p>beside the plot and table output options, an <a href='RLum.Results-class.html'>RLum.Results</a> object
is returned.</p>
<p><code>fit</code>:
an <code>nls</code> object (<code>$fit</code>) for which generic R functions
are provided, e.g. summary, confint, profile. For more
details, see nls.</p>
<p><code>output.table</code>:
a data.frame containing the summarised parameters including the error<br />
<code>component.contribution.matrix</code>: matrix containing the values
for the component to sum contribution plot (<code>$component.contribution.matrix</code>).<br /></p>
<p>Matrix structure:<br />
Column 1 and 2: time and <code>rev(time)</code> values<br />
Additional columns are used for the components, two for each component,
containing I0 and n0. The last columns <code>cont.</code> provide information on
the relative component contribution for each time interval including the row
sum for this values.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><strong>Fitting function</strong></p>
<p>The function for the CW-OSL fitting has the general form:</p>
<p>$$y = I0_{1}*\lambda_{1}*exp(-\lambda_1*x) + ,\ldots, + I0_{i}*\lambda_{i}*exp(-\lambda_i*x) $$</p>
<p>where \(0 &lt; i &lt; 8\)</p>
<p>and \(\lambda\) is the decay constant <br />
and \(I0\) the intial number of trapped electrons.</p>
<p><em>(for the used equation cf. Boetter-Jensen et al., 2003, Eq. 2.31)</em></p>
<p><strong>Start values</strong></p>
<p>Start values are estimated automatically by fitting a linear function to the
logarithmized input data set. Currently, there is no option to manually
provide start parameters.</p>
<p><strong>Goodness of fit</strong></p>
<p>The goodness of the fit is given as pseudoR^2 value (pseudo coefficient of
determination). According to Lave (1970), the value is calculated as:</p>
<p>$$pseudoR^2 = 1 - RSS/TSS$$</p>
<p>where \(RSS = Residual~Sum~of~Squares\) <br />
and \(TSS = Total~Sum~of~Squares\)</p>
<p><strong>Error of fitted component parameters</strong></p>
<p>The 1-sigma error for the
components is calculated using the function confint. Due to
considerable calculation time, this option is deactived by default. In
addition, the error for the components can be estimated by using internal R
functions like summary. See the nls help page
for more information.</p>
<p><em>For details on the nonlinear regression in R, see Ritz &amp; Streibig (2008).</em></p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p><strong>Beta version - This function has not been properly tested yet and</strong>
<strong>should therefore not be used for publication purposes!</strong></p>
<p>The pseudo-R^2 may not be the best parameter to describe the goodness of the
fit. The trade off between the <code>n.components</code> and the pseudo-R^2 value
is currently not considered.</p>
<p>The function <strong>does not</strong> ensure that the fitting procedure has reached a
global minimum rather than a local minimum!</p>
    
    <h2 class="hasAnchor" id="function-version"><a class="anchor" href="#function-version"></a>Function version</h2>

    <p>0.5.2</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Boetter-Jensen, L., McKeever, S.W.S., Wintle, A.G., 2003.
Optically Stimulated Luminescence Dosimetry. Elsevier Science B.V.</p>
<p>Lave, C.A.T., 1970. The Demand for Urban Mass Transportation. The Review of
Economics and Statistics, 52 (3), 320-323.</p>
<p>Ritz, C. &amp; Streibig, J.C., 2008. Nonlinear Regression with R. In: R.
Gentleman, K. Hornik, G. Parmigiani, eds., Springer, p. 150.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='fit_LMCurve.html'>fit_LMCurve</a>, plot,nls, <a href='RLum.Data.Curve-class.html'>RLum.Data.Curve</a>,
<a href='RLum.Results-class.html'>RLum.Results</a>, <a href='get_RLum.html'>get_RLum</a>, <a href='http://www.rdocumentation.org/packages/minpack.lm/topics/nlsLM'>minpack.lm::nlsLM</a></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>##load data</span>
<span class='fu'>data</span>(<span class='no'>ExampleData.CW_OSL_Curve</span>, <span class='kw'>envir</span> <span class='kw'>=</span> <span class='fu'>environment</span>())

<span class='co'>##fit data</span>
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_CWCurve</span>(<span class='kw'>values</span> <span class='kw'>=</span> <span class='no'>ExampleData.CW_OSL_Curve</span>,
                   <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"CW Curve Fit"</span>,
                   <span class='kw'>n.components.max</span> <span class='kw'>=</span> <span class='fl'>4</span>,
                   <span class='kw'>log</span> <span class='kw'>=</span> <span class='st'>"x"</span>)</div><div class='output co'>#&gt; 
#&gt; [fit_CWCurve()]
#&gt; 
#&gt; Fitting was finally done using a 3-component function (max=4):
#&gt; ------------------------------------------------------------------------------
#&gt; y ~ I0.1 * lambda.1 * exp(-lambda.1 * x) + I0.2 * lambda.2 * exp(-lambda.2 * x) + I0.3 * lambda.3 * exp(-lambda.3 * x)
#&gt; 
#&gt;          I0 I0.error     lambda lambda.error           cs cs.rel
#&gt; c1 2387.617       NA 4.59053972           NA 5.389396e-17 1.0000
#&gt; c2 1053.491       NA 1.95936444           NA 2.300337e-17 0.4268
#&gt; c3 2816.630       NA 0.02054734           NA 2.412303e-19 0.0045
#&gt; ------------------------------------------------------------------------------
#&gt; pseudo-R^2 = 0.9995</div><div class='img'><img src='fit_CWCurve-1.png' alt='' width='700' height='433' /></div><div class='input'>                   
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#function-version">Function version</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Sebastian Kreutzer, IRAMAT-CRP2A, Universite Bordeaux Montaigne (France)

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Sebastian Kreutzer, Christoph Burow, Michael Dietze, Margret C. Fuchs, Christoph Schmidt, Manfred Fischer, Johannes Friedrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

