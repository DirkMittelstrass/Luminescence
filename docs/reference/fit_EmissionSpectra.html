<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Luminescence Emission Spectra Deconvolution — fit_EmissionSpectra • Luminescence</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Luminescence Emission Spectra Deconvolution — fit_EmissionSpectra" />

<meta property="og:description" content="Luminescence spectra deconvolution on RLum.Data.Spectrum and matrix objects
on an energy scale. The function is optimised for emission spectra typially
obtained in the context of TL, OSL and RF measurements detected between 200 and 1000 nm." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Luminescence</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.1.9000.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/index.html">
    <span class="fa fa-play"></span>
     
    Articles
  </a>
</li>
<li>
  <a href="../reference/index.html">References</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../news/NEWS_Version0.9.0.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/R-Lum/Luminescence">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Luminescence Emission Spectra Deconvolution</h1>
    
    <div class="hidden name"><code>fit_EmissionSpectra.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Luminescence spectra deconvolution on <a href='RLum.Data.Spectrum-class.html'>RLum.Data.Spectrum</a> and <a href='https://rdrr.io/r/base/matrix.html'>matrix</a> objects
on an <strong>energy scale</strong>. The function is optimised for emission spectra typially
obtained in the context of TL, OSL and RF measurements detected between 200 and 1000 nm.</p>
    
    </div>

    <pre class="usage"><span class='fu'>fit_EmissionSpectra</span>(<span class='no'>object</span>, <span class='kw'>frame</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>start_parameters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>sub_negative</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>input_scale</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>method_control</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>plot</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p><a href='RLum.Data.Spectrum-class.html'>RLum.Data.Spectrum</a>, <a href='https://rdrr.io/r/base/matrix.html'>matrix</a> (<strong>required</strong>): input
object. Please note that an energy spectrum is expected</p></td>
    </tr>
    <tr>
      <th>frame</th>
      <td><p><a href='https://rdrr.io/r/base/numeric.html'>numeric</a> (<em>optional</em>): defines the frame to be analysed</p></td>
    </tr>
    <tr>
      <th>start_parameters</th>
      <td><p>(<em>optional</em>): allows to provide own start parameters for a
semi-automated precedure. ##TODO</p></td>
    </tr>
    <tr>
      <th>sub_negative</th>
      <td><p><a href='https://rdrr.io/r/base/numeric.html'>numeric</a> (<em>with default</em>): substitute negative values in the input object
by the number provided here (default: <code>0</code>). Can be set to <code>NULL</code>, i.e. negative values are kept.</p></td>
    </tr>
    <tr>
      <th>input_scale</th>
      <td><p><a href='https://rdrr.io/r/base/character.html'>character</a> (<em>optional</em>): defines whether your x-values define wavelength or
energy values. For the analysis an energy scale is expected, allowed values are <code>'wavelength'</code> and
<code>'energy'</code>. If nothing (<code>NULL</code>) is defined, the function tries to understand the input
automatically.</p></td>
    </tr>
    <tr>
      <th>method_control</th>
      <td><p><a href='https://rdrr.io/r/base/list.html'>list</a> (<em>optional</em>): options to control the fit method, see details</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p><a href='https://rdrr.io/r/base/logical.html'>logical</a> (<em>with default</em>): enable/disable verbose mode</p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p><a href='https://rdrr.io/r/base/logical.html'>logical</a> (<em>with default</em>): enable/disable plot output</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>further arguments to be passed to control the plot output
(supported: <code>main</code>, <code>xlab</code>, <code>ylab</code>, <code>xlim</code>, <code>ylim</code>, <code>log</code>, <code>mtext</code>, <code>legend</code> (<code>TRUE</code> or <code>FALSE</code>),
<code>legend.text</code>, <code>legend.pos</code>)</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>-----------------------------------<br />
<code>[ NUMERICAL OUTPUT ]</code><br />
-----------------------------------<br /></p>
<p><strong><code>RLum.Results</code></strong>-object</p>
<p><strong>slot:</strong> <strong><code>@data</code></strong></p>
<table class='table'>
<tr><td><strong>Element</strong></td><td><strong>Type</strong></td><td><strong>Description</strong></td></tr>
<tr><td><code>$data</code></td><td><code>matrix</code></td><td>the final fit matrix</td></tr>
<tr><td><code>$fit</code></td><td><code>nls</code></td><td>the fit object returned by <a href='https://rdrr.io/pkg/minpack.lm/man/nls.lm.html'>minpack.lm::nls.lm</a></td></tr>
</table>


<p><strong>slot:</strong> <strong><code>@info</code></strong></p>
<p>The original function call</p>
<p>------------------------<br />
<code>[ TERMINAL OUTPUT ]</code>   <br />
------------------------<br /></p>
<p>The terminal output provides brief information on the
deconvolution process and the obtained results.
Terminal output is only shown of the argument <code>verbose = TRUE</code>.</p>
<p>------------------------<br />
<code>[ PLOT OUTPUT ]</code>      <br />
------------------------<br /></p>
<p>The function returns a plot showing the raw signal with the
detected components. If the fitting failed, a basic plot is returned
showing the raw data and indicating the peaks detected for the start
parameter estimation.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><strong>Used equation</strong></p>
<p>The emission spectra (on an energy scale) can be best described as the sum of multiple
Gaussian components:</p>
<p>'$$
y = \Sigma  Ci * 1/(\sigma_{i} * \sqrt(2 * \pi)) * exp(1/2 * ((x - \mu_{i})/\sigma_{i}))^2)
$$</p>
<p>with the parameters \(\sigma\) (peak width) and \(\mu\) (peak centre) and \(C\)
(scaling factor).</p>
<p><strong>Start parameter estimation and fitting algorithm</strong></p>
<p>The spectrum deconvolution consits of the following steps:</p><ol>
<li><p>Peak finding <br /></p></li>
<li><p>Start parameter estimation <br /></p></li>
<li><p>Fitting via <a href='https://rdrr.io/pkg/minpack.lm/man/nls.lm.html'>minpack.lm::nls.lm</a><br /></p></li>
</ol>
    <p>The peak finding is realised by an approach (re-)suggested by Petr Pikal via the R-help
mailing list (https://stat.ethz.ch/pipermail/r-help/2005-November/thread.html) in November 2005.
This goes back to even earlier discussion in 2001 based on Prof Brian Ripley's idea.
It smartly uses the functions <a href='https://rdrr.io/r/stats/embed.html'>stats::embed</a> and <a href='https://rdrr.io/r/base/maxCol.html'>max.col</a> to identify peaks positions.
For the use in this context, the algorithm has been further modified to scale on the
input data resolution (cv source code).<br /></p>
<p>The start parameter estimation uses random sampling from a range of meaningful parameters
and repeats the fitting until 100 sucessful fits have been produced or the set <code>max.runs</code> value
is exceeded.</p>
<p>Currently the best fit is the one with the lowest number for squared residuals.</p>
<p><strong>Supported <code>method_control</code> settings</strong></p>
<table class='table'>
<tr><td><strong>Parameter</strong></td><td><strong>Type</strong></td><td><strong>Default</strong></td><td><strong>Descritpion</strong></td></tr>
<tr><td><code>max.runs</code></td><td><a href='https://rdrr.io/r/base/integer.html'>integer</a></td><td><code>1000</code></td><td>maximum allowed search iterations, if exceed
the searching stops</td></tr>
<tr><td><code>trace</code></td><td><a href='https://rdrr.io/r/base/logical.html'>logical</a></td><td><code>FALSE</code></td><td>enables/disables the tracing of the minimisation routine</td></tr>
</table>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Beta version, not uet recommended for productive usage</p>
    
    <h2 class="hasAnchor" id="function-version"><a class="anchor" href="#function-version"></a>Function version</h2>

    <p>0.1.0</p>
    
    <h2 class="hasAnchor" id="how-to-cite"><a class="anchor" href="#how-to-cite"></a>How to cite</h2>

    <p>Kreutzer, S. (2019). fit_EmissionSpectra(): Luminescence Emission Spectra Deconvolution. Function version 0.1.0. In: Kreutzer, S., Burow, C., Dietze, M., Fuchs, M.C., Schmidt, C., Fischer, M., Friedrich, J. (2019). Luminescence: Comprehensive Luminescence Dating Data AnalysisR package version 0.9.1.9000-11. https://CRAN.R-project.org/package=Luminescence</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>##TODO</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='RLum.Data.Spectrum-class.html'>RLum.Data.Spectrum</a>, <a href='RLum.Results-class.html'>RLum.Results</a>, <a href='plot_RLum.html'>plot_RLum</a>,
<a href='convert_Wavelength2Energy.html'>convert_Wavelength2Energy</a>, <a href='https://rdrr.io/pkg/minpack.lm/man/nls.lm.html'>minpack.lm::nls.lm</a></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
##deconvolution of a TL spectrum
##TODO should be modified ...
</div><span class='co'># NOT RUN {</span>
<span class='co'>##load example data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>ExampleData.XSYG</span>, <span class='kw'>envir</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>environment</a></span>())

<span class='co'>##subtract background</span>
<span class='no'>TL.Spectrum</span>@<span class='kw'>data</span> <span class='kw'>&lt;-</span> <span class='no'>TL.Spectrum</span>@<span class='kw'>data</span>[] - <span class='no'>TL.Spectrum</span>@<span class='kw'>data</span>[,<span class='fl'>15</span>]

<span class='co'>##replace 0 values</span>
<span class='no'>results</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_EmissionSpectra</span>(
 <span class='kw'>object</span> <span class='kw'>=</span> <span class='no'>TL.Spectrum</span>,
 <span class='kw'>frame</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"TL spectrum"</span>
)

<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#function-version">Function version</a></li>

      <li><a href="#how-to-cite">How to cite</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Sebastian Kreutzer, IRAMAT-CRP2A, UMR 5060, CNRS - Université Bordeaux Montaigne (France)</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Sebastian Kreutzer, Christoph Burow, Michael Dietze, Margret C. Fuchs, Christoph Schmidt, Manfred Fischer, Johannes Friedrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

