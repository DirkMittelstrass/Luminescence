<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fitting and Deconvolution of OSL Lifetime Components — fit_OSLLifeTimes • Luminescence</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Fitting and Deconvolution of OSL Lifetime Components — fit_OSLLifeTimes" />

<meta property="og:description" content="Fitting and Deconvolution of OSL Lifetime Components" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Luminescence</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.1.9000.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../articles/index.html">
    <span class="fa fa-play"></span>
     
    Articles
  </a>
</li>
<li>
  <a href="../reference/index.html">References</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../news/NEWS_Version0.9.0.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/R-Lum/Luminescence">
    <span class="fa fa-github"></span>
     
    GitHub
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fitting and Deconvolution of OSL Lifetime Components</h1>
    
    <div class="hidden name"><code>fit_OSLLifeTimes.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Fitting and Deconvolution of OSL Lifetime Components</p>
    
    </div>

    <pre class="usage"><span class='fu'>fit_OSLLifeTimes</span>(<span class='no'>object</span>, <span class='kw'>tp</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>signal_range</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>n.components</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>method_control</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(), <span class='kw'>plot</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p><a href='RLum.Data.Curve-class.html'>RLum.Data.Curve</a>, <a href='RLum.Analysis-class.html'>RLum.Analysis</a>, <a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a> or <a href='https://rdrr.io/r/base/matrix.html'>matrix</a> <strong>(required)</strong>:
Input object containing the data to be analysed. All objects can be provided also as list for an automated
processing. Please note: <code>NA</code> values are automatically removed and the dataset should comprise at least 5 data points.</p></td>
    </tr>
    <tr>
      <th>tp</th>
      <td><p><a href='https://rdrr.io/r/base/numeric.html'>numeric</a> (<em>with default</em>): option to account for the stimulation pulse width. For off-time measurements
the default value is 0. <code>tp</code> has the same unit as the measurement data, e.g., µs. Please set this parameter
carefully, if it all, otherwise you may heavily bias your fit results.</p></td>
    </tr>
    <tr>
      <th>signal_range</th>
      <td><p><a href='https://rdrr.io/r/base/numeric.html'>numeric</a> (<em>optional</em>): allows to set a channel range, by default all channels are used, e.g.
<code>signal_range = c(2,100)</code> considers only channels 2 to 100 and <code>signal_range = c(2)</code> considers only channels
from channel 2 onwards.</p></td>
    </tr>
    <tr>
      <th>n.components</th>
      <td><p><a href='https://rdrr.io/r/base/numeric.html'>numeric</a> (<em>optional</em>): Fix the number of components. If set the algorithm will try
to fit the number of predefined components. If nothing is set, the algorithm will try to find the best number
of components.</p></td>
    </tr>
    <tr>
      <th>method_control</th>
      <td><p><a href='https://rdrr.io/r/base/list.html'>list</a> (<em>optonal</em>): Named to allow a more fine control of the fitting process. See details
for allowed options.</p></td>
    </tr>
    <tr>
      <th>plot</th>
      <td><p><a href='https://rdrr.io/r/base/logical.html'>logical</a> (<em>with default</em>): Enable/disable plot output</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p><a href='https://rdrr.io/r/base/logical.html'>logical</a> (<em>with default</em>): Enable/disable terminal feedback</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>parameters passed to <a href='https://rdrr.io/r/graphics/plot.default.html'>plot.default</a> to control the plot output. Please note that not
all parameters are supported.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>-----------------------------------<br />
<code>[ NUMERICAL OUTPUT ]</code><br />
-----------------------------------<br /></p>
<p><strong><code>RLum.Results</code></strong>-object</p>
<p><strong>slot:</strong> <strong><code>@data</code></strong></p>
<table class='table'>
<tr><td><strong>Element</strong></td><td><strong>Type</strong></td><td><strong>Description</strong></td></tr>
<tr><td><code>$data</code></td><td><code>matrix</code></td><td>the final fit matrix</td></tr>
<tr><td><code>$start_matrix</code></td><td><code>matrix</code></td><td>the start matrix used for the fitting</td></tr>
<tr><td><code>$total_counts</code></td><td><code>integer</code></td><td>Photon count sum</td></tr>
<tr><td><code>$fit</code></td><td><code>nls</code></td><td>the fit object returned by <a href='https://rdrr.io/pkg/minpack.lm/man/nls.lm.html'>minpack.lm::nls.lm</a></td></tr>
</table>


<p><strong>slot:</strong> <strong><code>@info</code></strong></p>
<p>The original function call</p>
<p>------------------------<br />
<code>[ TERMINAL OUTPUT ]</code><br />
------------------------<br /></p>
<p>Terminal output is only shown of the argument <code>verbose = TRUE</code>.</p>
<p><em>(1) Start parameter and component adapation</em><br />
Trave of the parameter adaption process</p>
<p><em>(2) Fitting results (sorted by ascending tau)</em><br />
The fitting results sorted by ascending tau value. Please note
that if you access the <code>nls</code> fitting object, the values are not sorted.</p>
<p><em>(3) Further information</em><br /></p><ul>
<li><p>The photon count sum</p></li>
<li><p>Durbin-Watson residual statistic to asses whether the residuals are correlated, ideally
the residuals should be not correlated at all. Rough measures are: <br />
D = 0: the residuls are systematically correlated <br />
D = 2: the residuals are randomly distributed <br />
D = 4: the residuals are systematically anticorrlated<br /></p></li>
</ul>

<p>You should be suspicious if D differs largely from 2.</p>
<p>------------------------<br />
<code>[ PLOT OUTPUT ]</code><br />
------------------------<br /></p>
<p>A plot showing the original data and the fit so far possible. The lower plot shows the
residuals of the fit.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function intends to provide an easy access to pulsed optically stimulated luminescence (POSL) data,
in order determine signal lifetimes. The fitting is currently optimised to work with the off-time flank of POSL measurements
only. For the signal deconvolution, a differential evolution optimisation is combined with nonlinear least-square fitting
following the approach by Bluszcz &amp; Adamiec (2006).</p>
<p><strong>Component deconvolution algorithm</strong></p>
<p>The component deconvolution consists of two steps:</p>
<p>(1) Adaption phase</p>
<p>In the adaption phase the function tries to figure out the optimal and statistically justified
number of signal components following roughly the approach suggestd by Bluszcz &amp; Adamiec (2006). In
contrast to their work, for the optimisation by differential evolution here the package 'DEoptim' is used.</p>
<p>The function to be optimized has the form:</p>
<p>$$\chi^2 = \sum(w * (n_i/c - \sum(A_i * exp(-x/(tau_i + t_p))))^2)$$</p>
<p>with \(w = 1\) for unweighted regression analysis (<code>method_control = list(weights = FALSE)</code>) or
\(w = c^2/n_i\) for weighted regression analysis. The default values is <code>TRUE</code>.</p>
<p>$$F = (\Delta\chi^2 / 2) / (\chi^2/(N - 2*m - 2))$$</p>
<p>(2) Final fitting</p>
<p><strong><code>method_control</code></strong></p>
<table class='table'>
<tr><td><strong>Parameter</strong></td><td><strong>Type</strong></td><td><strong>Description</strong></td></tr>
<tr><td><code>p</code></td><td><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></td><td>controls the probability for the F statistic reference values. For a significance level of 5% a value of 0.95 (the default) should be added, for 1%, a value of 0.99 is sufficient: 1 &gt; p &gt; 0 (cf. <a href='https://rdrr.io/r/stats/Fdist.html'>stats::qf</a>)</td></tr>
<tr><td><code>seed</code></td><td><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></td><td>set the seed for the random number generator, provide a value here to get reproducible results</td></tr>
<tr><td><code>DEoptim.trace</code></td><td><a href='https://rdrr.io/r/base/logical.html'>logical</a></td><td>enables/disables the tracing of the differential evolution (cf. <a href='https://rdrr.io/pkg/DEoptim/man/DEoptim.control.html'>DEoptim::DEoptim.control</a>)</td></tr>
<tr><td><code>DEoptim.itermax</code></td><td><a href='https://rdrr.io/r/base/logical.html'>logical</a></td><td>controls the number of the allowed generations (cf. <a href='https://rdrr.io/pkg/DEoptim/man/DEoptim.control.html'>DEoptim::DEoptim.control</a>)</td></tr>
<tr><td><code>weights</code></td><td><a href='https://rdrr.io/r/base/logical.html'>logical</a></td><td>enables/disables the weighting for the start parameter estimation and fitting (see equations above).
The default values is <code>TRUE</code></td></tr>
<tr><td><code>nlsLM.trace</code></td><td><a href='https://rdrr.io/r/base/logical.html'>logical</a></td><td>enables/disables trace mode for the nls fitting (<a href='https://rdrr.io/pkg/minpack.lm/man/nlsLM.html'>minpack.lm::nlsLM</a>), can be used to identify convergence problems, default is <code>FALSE</code></td></tr>
<tr><td><code>nlsLM.upper</code></td><td><a href='https://rdrr.io/r/base/logical.html'>logical</a></td><td>enables/disables upper parameter boundary, default is <code>TRUE</code></td></tr>
<tr><td><code>nlsLM.lower</code></td><td><a href='https://rdrr.io/r/base/logical.html'>logical</a></td><td>enables/disables lower parameter boundary, default is <code>TRUE</code></td></tr>
</table>
    
    <h2 class="hasAnchor" id="function-version"><a class="anchor" href="#function-version"></a>Function version</h2>

    <p>0.1.3</p>
    
    <h2 class="hasAnchor" id="how-to-cite"><a class="anchor" href="#how-to-cite"></a>How to cite</h2>

    <p>Kreutzer, S., Schmidt, C. (2019). fit_OSLLifeTimes(): Fitting and Deconvolution of OSL Lifetime Components. Function version 0.1.3. In: Kreutzer, S., Burow, C., Dietze, M., Fuchs, M.C., Schmidt, C., Fischer, M., Friedrich, J. (2019). Luminescence: Comprehensive Luminescence Dating Data AnalysisR package version 0.9.1.9000-11. https://CRAN.R-project.org/package=Luminescence</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Bluszcz, A., Adamiec, G., 2006. Application of differential evolution to fitting OSL decay curves.
Radiation Measurements 41, 886-891. doi:10.1016/j.radmeas.2006.05.016<br /></p>
<p>Durbin, J., Watson, G.S., 1950. Testing for Serial Correlation in Least Squares Regression: I.
Biometrika 37, 409-21. doi:10.2307/2332391</p>
<p><strong>Further reading</strong></p>
<p>Hughes, I., Hase, T., 2010. Measurements and Their Uncertainties. Oxford University Press.</p>
<p>Storn, R., Price, K., 1997. Differential Evolution –
A Simple and Efficient Heuristic for Global Optimization over Continuous Spaces.
Journal of Global Optimization 11, 341–359.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='https://rdrr.io/pkg/minpack.lm/man/nls.lm.html'>minpack.lm::nls.lm</a>, <a href='https://rdrr.io/pkg/DEoptim/man/DEoptim.html'>DEoptim::DEoptim</a></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>##load example data</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>ExampleData.TR_OSL</span>, <span class='kw'>envir</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>environment</a></span>())

<span class='co'>##fit lifetimes (short run)</span>
<span class='fu'>fit_OSLLifeTimes</span>(
 <span class='kw'>object</span> <span class='kw'>=</span> <span class='no'>ExampleData.TR_OSL</span>,
 <span class='kw'>n.components</span> <span class='kw'>=</span> <span class='fl'>1</span>)</div><div class='output co'>#&gt; 
#&gt; [fit_OSLLifeTime()]
#&gt; 
#&gt; (1) Start parameter and component adapation
#&gt; ---------------------(start adaption)------------------------------------
#&gt; &gt;&gt; + adaption for 1 comp. :  Inf (calc.) &lt;&gt;  3 (ref.) &gt;&gt; [add comp.] &gt;&gt; [forced stop]
#&gt; ---------------------(end adaption)--------------------------------------
#&gt; 
#&gt; 
#&gt; &gt;&gt; Applied component matrix
#&gt;                   A     tau
#&gt; Comp.1 2.118737e+12 87.9146
#&gt; 
#&gt; 
#&gt; (2) Fitting results (sorted by ascending tau)
#&gt; -------------------------------------------------------------------------
#&gt;           Estimate   Std. Error   t value      Pr(&gt;|t|)
#&gt; A.1   2.118737e+10 9.710554e+07 218.18915  0.000000e+00
#&gt; tau.1 8.791461e+01 3.167935e+00  27.75139 1.196535e-143
#&gt; -------------------------------------------------------------------------
#&gt; 
#&gt; (3) Further information
#&gt; -------------------------------------------------------------------------
#&gt; Photon count sum:  3.831e+13 
#&gt; Durbin-Watson residual statistic:  0.77 [ &lt;&gt;        ]
#&gt; </div><div class='output co'>#&gt; <span class='warning'>Warning: conversion failure on 'ε' in 'mbcsToSbcs': dot substituted for &lt;ce&gt;</span></div><div class='output co'>#&gt; <span class='warning'>Warning: conversion failure on 'ε' in 'mbcsToSbcs': dot substituted for &lt;b5&gt;</span></div><div class='img'><img src='fit_OSLLifeTimes-1.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt;  [RLum.Results-class]
#&gt; 	 originator: fit_OSLLifeTimes()
#&gt; 	 data: 4
#&gt;  	 .. $data : matrix
#&gt; 	 .. $start_matrix : matrix
#&gt; 	 .. $total_counts : numeric
#&gt; 	 .. $fit : nls
#&gt; 	 additional info elements:  1</div><div class='input'>
##long example
</div><span class='co'># NOT RUN {</span>
<span class='fu'>fit_OSLLifeTimes</span>(
<span class='kw'>object</span> <span class='kw'>=</span> <span class='no'>ExampleData.TR_OSL</span>)
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#function-version">Function version</a></li>

      <li><a href="#how-to-cite">How to cite</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Sebastian Kreutzer, IRAMAT-CRP2A, UMR 5060, CNRS-Université Bordeaux Montaigne (France),
Christoph Schmidt, University of Bayreuth (Germany)</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Sebastian Kreutzer, Christoph Burow, Michael Dietze, Margret C. Fuchs, Christoph Schmidt, Manfred Fischer, Johannes Friedrich.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

