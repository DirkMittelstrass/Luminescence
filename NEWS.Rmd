---
output: github_document
header-includes:
   - \usepackage{amsmath}
   - \usepackage{amssymb}
---
<!-- NEWS.md was auto-generated by NEWS.Rmd. Please DO NOT edit by hand!-->

```{r, echo = FALSE, warning=FALSE, message=FALSE}
temp <- readLines("DESCRIPTION")
version_id <- grep(pattern = "Version:", x = temp, fixed = TRUE)
version_number <-
  unlist(strsplit(x = temp[version_id], split = ":", fixed = TRUE))[2]
version_number <-
  unlist(strsplit(x = version_number, split = ".", fixed = TRUE))
version_number <- paste(version_number[-length(version_number)], collapse = ".")
```

## Changes in version `r version_number` (`r Sys.Date()`)

### New functions

* `convert_Wavelength2Energy()` Smooth and quick emission spectra conversion from wavelength to energy scales
* `fit_EmissionSpectra()` Luminescence emission spectra deconvolution
* `fit_OSLLifeTimes()` Fit and deconvolution of OSL lifetimes using off-time measurements,
i.e. after the stimulation was switched off.
* `plot_DRCSummary()` Summarise all dose-response curves from your SAR OSL 
analysis in one single plot.
* `scale_GammaDose()` Scale the gamma dose rate considering layer-to-layer variations
in soil radioactivity. Contributed by S. Riedesel and M. Autzen.
* `fit_ThermalQuenching()` Provide an easy option to fit thermal quenching data and      determine the activation energy.
* `read_RF2R()` Add support for importing spatially resolved RF measurement results.

### Bugfixes and changes

#### `apply_CosmicRayRemoval()`
* Thanks to black magic, this function now runs also over a list of `RLum.Data.Spectrum` objects and 
and `RLum.Analysis` objects (also nested in a list)

#### `apply_EfficiencyCorrection()`
* The function produced a warning ("collapsing to unique 'x' values") on R-devel; fixed.

#### `analyse_SAR.TL()`
* The plot legend was not correct, if no dose points had been provided; fixed
* The function returned a confusion warning; fixed.
* If background signals are provided, now the background subtracted 
signal is shown automatically instead of the uncorrected curves (suggestion by Tilmann Wolpert)
* The function now supports a list of `RLum.Analysis` objects as input
* The plot settings were sufficiently reset; fixed. 
* Code polish

#### `analyse_FadingMeasurements()`
* Enable support for data imported from a BIN/BINX-file
* If the g-value is negative, now it also returns a negative g-value; before always the absolute
values was taken, which was not meaningful
* If rho was negative, the log10 value could not be calculated, this caused an unwanted warning; 
now suppressed
* It showed a warning on R-devel due to changes in `stats::approx()`; fixed
* Records with negative 'time since irradiation' are now automatically removed (thanks to input by SÃ©bastien Huot)
* Function is now more relaxed when odd data a provided

#### `calc_Huntley2006()`
* The function now checks if rho' (`rhop`) is a sensible non-zero positive value and,
if otherwise, stops with a more meaningful error message. (Issue \#74)
* Now the function is a little bit less talkative if extrem dataset are provided as input

#### `read_BIN2R()`
* Add support for missing BINX-file version 5 (pointed out by Harrison Gray)
* In the auto-file recognition (only a path instead of a file is provided), sometimes the found BIN/BINX-files were imported twice. The corresponding code was simplified to avoid such errors in future.

#### `read_XSYG2R()`
* The function failed for R-devel importing spectrometer data (`approx(..., ties = -2)`); fixed.

#### `plot_GrowthCurve()`
* The function crashed with `Error in data.MC[, i] : incorrect number of dimensions` under very particular 
circumstances (reported by Alice Versendaal). This was due to unwanted internal object conversion; fixed.

#### `plot_RLum.Data.Spectrum()`
* The wavelength to energy scale conversion was not correct. This was corrected and internally, 
the function now calls consistently the new function `convert_Wavelength2Enegy()` (the corresponding 
code and documentation have been updated or removed).  
* The function gained a new argument `norm` for normalising the data to the highest or the lowest count value.
* The function gained a new argument `bg.spectrum` allow to pass a background spectrum that can be used for the subtraction
* The function returned a warning if a single matrix was used but `plot.type` was already set to `single`; fixed.
* Wrong settings in `bg.channels` crashed the function. Now it auto-corrects the wrong values.
* Channel binning now consistently calls the internal function `Luminescence:::.matrix_binning()`, which is more
efficient cleaner than the code used before
* The function now longer crashes for `plot.type = 'persp'` if 'xaxis.energy = TRUE`. 
* The colour picking option was not always working; fixed.
* Warnings are formatted more nicely.

#### `write_RLum2CSV()`
* The function gained a new argument `compact` which is set `TRUE` be default, and keeps 
the element output as simple as possible, which is in particular helpful for `RLum.Results` objects
* The function now behaves more friendly to `RLum.Results` objects, before the output was hard
to understand.

### Changes in S4-objects and methods
#### `RLum.Analysis-class`
* The show-method crashed under very rare circumstances if inconsistent objects had been combined; fixed.

#### `RLum.Data.Spectrum-class` 
* Support added for `bin_RLum.Data()`

### Internals

* Package news are now provided as markdown document (NEWS.md) which is supported
by CRAN
* The package version numbering scheme has been modified to simplify the 
distinction between different developer versions. While relevant numbers
for CRAN remain X.X.X, which reads 'stable.major.minor' version, a 4th number
indicates the running package build number, e.g., 0.9.0.7.
* New internal function `Luminescence:::.matrix_binning()` to get the matrix (and curve) binning 
consistent; so far used only by the the `bin_RLum.Data()` method for `RLum.Data.Spectrum-class`
* Vignette S4-class object structure updated


